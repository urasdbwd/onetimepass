<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta property="og:title" content="Things OTP">
    <meta property="og:site_name" content="Things One Time Password Gen">
    <meta property="og:description" <body>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
                integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">

    </style>
</head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <center>
        <style>
            body {
                font-family: 'Varela Round';
                font-size: 22px;
            }
        </style>

        <link href="https://fonts.googleapis.com/css?family=Varela Round" rel="stylesheet">
        <style>
            body {
                font-family: 'Varela Round';
                font-size: 22px;
            }
        </style>
        <h1>Things 2FA</h1>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
        <style>
            button#generate-otp:hover {
                transform: scale(1.1);
                transition: transform 0.5s;
            }
        </style>
        <script>
            function saveSecretKey() {
                    let secretKey = document.getElementById("secretKey").value;
                    const sanitizedSecretKey = secretKey.replace(/\s/g, '')
                    document.getElementById("secretKey").value = sanitizedSecretKey
                }
        </script>
                <label for="secretKey">Please enter the secret key:</label><br>
                <div class="input-group input-group-lg" style="width: 15%;">
                <input type="text" class="form-control" placeholder="Enter Secret Key Here" aria-label="2FS" aria-describedby="basic-addon1" id="secretKey"  name="secretKey" required>
                </div>
                <input type="button" value="Submit" id="generate-otp" onclick="saveSecretKey()">

        <div class="toast-container position-fixed top-0 end-0 p-3 ">
            <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-header">
                    <img src="..." class="rounded me-2" alt="...">
                    <strong class="me-auto">Things</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body">
                    OTP Generated!
                </div>
            </div>
        </div>


        <script>
            const generateOtpButton = document.getElementById('generate-otp')
            const optv = document.getElementById('otp-value')

            window.onload = () => {
                generateOtpButton.addEventListener('click', () => {
                    // Prompt the user for their secret key

                    // Send the POST request to the '/generate' endpoint
                    const response = fetch('./generate', {
                        method: 'POST',
                        headers: {
                            'Accept': 'application/json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            otp: document.getElementById("secretKey").value
                        }),
                    })

                    response.then(res => {
                        return res.json()
                    }).then(data => {
                        var toastBody = document.querySelector('.toast-body');
                         toastBody.innerHTML = "Your One-Time-Password is " + data.otp + "!";
                    })
                    var toastBody = document.querySelector('.toast-body');
                    const toastTrigger = document.getElementById('generate-otp')
                    const toastLiveExample = document.getElementById('liveToast')
                    if (toastTrigger) {
                        toastTrigger.addEventListener('click', () => {
                            const toast = new bootstrap.Toast(toastLiveExample)
                            toast.show()
                        })
                }
            })
            }
        </script>
        <style>
            body {
                background-color: #380356;
            }
        
            h1 {
                color: purple;
                margin-left: 40px;
            }
        </style>
    </center>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>

</body>
</center>
